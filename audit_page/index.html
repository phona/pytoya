<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyToYa Audit Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .pdf-viewer { aspect-ratio: 0.707; }
        .confidence-high { border-left: 3px solid #22c55e; }
        .confidence-medium { border-left: 3px solid #eab308; }
        .confidence-low { border-left: 3px solid #ef4444; }
        .field-editable:focus { outline: 2px solid #3b82f6; outline-offset: 1px; }
        .is-hidden { display: none !important; }
        .is-visible { display: block !important; }
        @media print {
            .no-print { display: none !important; }
        }
        html, body {
            overflow: hidden;
            height: 100%;
        }
        div.bg-gray-50.px-6.py-5 {
            padding-top: 1.25rem !important;
            padding-bottom: 3.25rem !important;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-slate-800 text-white shadow-lg no-print">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="fas fa-clipboard-check"></i>
                PyToYa Audit Dashboard
            </h1>
            <div class="flex items-center gap-4 text-sm">
                <span id="taskCounter" class="text-gray-400"></span>
            </div>
        </div>
    </header>

    <!-- Loading State -->
    <div id="loadingState" class="is-hidden container mx-auto px-4 py-12 text-center">
        <i class="fas fa-spinner fa-spin text-4xl text-blue-500 mb-4"></i>
        <p class="text-gray-600">Loading tasks...</p>
    </div>

    <!-- No Tasks State -->
    <div id="noTasksState" class="is-hidden container mx-auto px-4 py-12 text-center">
        <i class="fas fa-folder-open text-4xl text-gray-400 mb-4"></i>
        <p class="text-gray-600">No tasks found in results folder.</p>
    </div>

    <!-- Main Content -->
    <main id="mainContent" class="is-hidden flex-1 overflow-hidden min-h-0">
        <!-- Task List Sidebar -->
        <div class="flex h-full min-h-0">
            <aside class="w-80 bg-white shadow-lg h-full overflow-y-auto flex-shrink-0 no-print">
                <div class="p-4 border-b">
                    <h2 class="font-semibold text-gray-700 mb-3">Tasks</h2>
                    <div class="flex gap-2">
                        <select id="filterSelect" class="flex-1 text-sm border rounded px-2 py-1">
                            <option value="all">All</option>
                            <option value="unchecked" selected>Unchecked</option>
                            <option value="checked">Checked</option>
                        </select>
                        <select id="sortSelect" class="flex-1 text-sm border rounded px-2 py-1">
                            <option value="po">By PO</option>
                            <option value="date">By Date</option>
                            <option value="path">By Path</option>
                            <option value="status">By Status</option>
                        </select>
                    </div>
                    <div class="flex gap-2 mt-2">
                        <select id="searchAttribute" class="w-28 text-sm border rounded px-2 py-1">
                            <option value="all" selected>All</option>
                            <option value="name">Name</option>
                            <option value="po">PO</option>
                            <option value="date">Date</option>
                            <option value="department">Dept</option>
                            <option value="folder">Folder</option>
                            <option value="path">Path</option>
                            <option value="status">Status</option>
                            <option value="confidence">Confidence</option>
                        </select>
                        <input id="searchInput" type="text" class="flex-1 text-sm border rounded px-2 py-1" placeholder="Search">
                    </div>
                </div>
                <div id="taskList" class="divide-y">
                    <!-- Tasks will be inserted here -->
                </div>
            </aside>

            <!-- Main Panel -->
            <div class="flex-1 p-4 overflow-hidden">
                <!-- Current Task -->
                <div id="currentTask" class="bg-white rounded-lg shadow-lg overflow-hidden flex flex-col h-full">
                    <!-- Task Header -->
                    <div class="bg-gray-50 px-6 py-3 border-b flex items-center justify-between flex-shrink-0">
                        <div class="flex items-center gap-4">
                            <h2 id="taskTitle" class="font-semibold text-gray-800"></h2>
                            <span id="taskStatus" class="px-2 py-0.5 text-xs rounded-full"></span>
                        </div>
                        <div class="flex items-center gap-2 text-sm text-gray-500">
                            <span id="confidenceBadge" class="flex items-center gap-1"></span>
                            <span id="taskPath" class="text-xs"></span>
                        </div>
                    </div>

                    <!-- Two Column Layout -->
                    <div class="flex flex-col lg:flex-row flex-1 overflow-hidden min-h-0">
                        <!-- PDF Column -->
                        <div class="lg:w-1/2 p-4 border-r overflow-hidden flex flex-col min-h-0">
                            <div id="pdfContainer" class="bg-gray-200 rounded pdf-viewer overflow-auto flex items-center justify-center flex-1 min-h-0">
                                <iframe id="pdfViewer" src="" class="w-full h-full border-0"></iframe>
                            </div>
                        </div>

                        <!-- Data Column -->
                        <div class="lg:w-1/2 p-4 overflow-y-auto pb-8">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="font-medium text-gray-700">Parsed Data</h3>
                                <button onclick="reExtract()" class="px-2 py-1 text-xs bg-purple-100 text-purple-700 rounded hover:bg-purple-200">
                                    <i class="fas fa-redo mr-1"></i>Re-extract
                                </button>
                            </div>

                            <!-- Extraction Info Alert -->
                            <div id="extractionAlert" class="hidden mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <div class="flex items-start gap-2">
                                    <i class="fas fa-exclamation-triangle text-yellow-600 mt-0.5"></i>
                                    <div class="flex-1 text-sm">
                                        <p class="font-medium text-yellow-800">Extraction Issues</p>
                                        <ul id="extractionIssues" class="mt-1 text-yellow-700 list-disc list-inside"></ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Department Section -->
                            <div class="mb-4">
                                <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Department</h4>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="text-xs text-gray-500">Code</label>
                                        <input type="text" id="department_code" class="field-editable w-full border rounded px-2 py-1 text-sm">
                                    </div>
                                </div>
                            </div>

                            <!-- Invoice Section -->
                            <div class="mb-4">
                                <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2">Invoice</h4>
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="text-xs text-gray-500">PO Number</label>
                                        <input type="text" id="invoice_po_no" class="field-editable w-full border rounded px-2 py-1 text-sm">
                                    </div>
                                    <div>
                                        <label class="text-xs text-gray-500">Invoice Date</label>
                                        <input type="text" id="invoice_date" class="field-editable w-full border rounded px-2 py-1 text-sm" placeholder="YYYY-MM-DD">
                                    </div>
                                    <div class="col-span-2">
                                        <label class="text-xs text-gray-500">Usage</label>
                                        <input type="text" id="invoice_usage" class="field-editable w-full border rounded px-2 py-1 text-sm" placeholder="设备信息 (从申请/归口部门需求说明提取)">
                                    </div>
                                </div>
                            </div>

                            <!-- Items Section -->
                            <div class="mb-6">
                                <h4 class="text-xs font-semibold text-gray-500 uppercase mb-2 flex items-center justify-between">
                                    <span>Items</span>
                                    <button onclick="addItem()" class="text-blue-500 hover:text-blue-700" title="Add item">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </h4>
                                <div id="itemsContainer" class="space-y-2">
                                    <!-- Items will be inserted here -->
                                </div>
                            </div>

                            <!-- Human Checked -->
                            <div class="flex items-center gap-2 mb-12">
                                <input type="checkbox" id="human_checked" class="rounded">
                                <label for="human_checked" class="text-sm text-gray-700">Human Verified</label>
                            </div>
                        </div>
                    </div>

                    <!-- Actions Footer -->
                    <div class="bg-gray-50 px-6 py-5 border-t flex items-center justify-between no-print flex-shrink-0">
                        <div class="flex gap-2">
                            <button onclick="previousTask()" class="px-5 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-base font-medium">
                                <i class="fas fa-chevron-left mr-2"></i> Previous
                            </button>
                            <button onclick="nextTask()" class="px-5 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-base font-medium">
                                Next <i class="fas fa-chevron-right ml-2"></i>
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="saveChanges()" class="px-5 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-base font-medium">
                                <i class="fas fa-save mr-2"></i> Save (Ctrl+S)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 transform translate-y-full opacity-0 transition-all duration-300">
        <div class="bg-slate-800 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2">
            <i id="toastIcon" class="fas fa-check-circle"></i>
            <span id="toastMessage"></span>
        </div>
    </div>

    <script src="audit.js"></script>
</body>
</html>

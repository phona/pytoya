{{- $ns := default .Release.Namespace .Values.global.namespace -}}
{{- $fullname := include "pytoya.fullname" . -}}

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $fullname }}-config
  namespace: {{ $ns }}
  labels:
    {{- include "pytoya.labels" . | nindent 4 }}
data:
  config.yaml: |
    server:
      port: {{ .Values.api.config.server.port }}
      logLevel: {{ .Values.api.config.server.logLevel }}
    database:
      host: {{ .Values.api.config.database.host | quote }}
      port: {{ .Values.api.config.database.port }}
      username: {{ .Values.api.config.database.username | quote }}
      password: {{ .Values.postgres.auth.password | quote }}
      database: {{ .Values.api.config.database.database | quote }}
    redis:
      host: {{ .Values.api.config.redis.host | quote }}
      port: {{ .Values.api.config.redis.port }}
    jwt:
      secret: {{ .Values.secrets.jwtSecret | quote }}
      expiration: 7d
    paddleocr:
      baseUrl: {{ .Values.api.config.paddleocr.baseUrl | quote }}
    llm:
      apiKey: {{ .Values.secrets.llmApiKey | quote }}
  # Web env vars (remain as-is for frontend build)
  VITE_API_URL: {{ .Values.web.env.VITE_API_URL | quote }}

global:
  namespace: pytoya
  createNamespace: false
  imageRegistry: ""
  imagePullSecrets: []
  nodeSelector: {}
  tolerations: []
  affinity: {}

## NOTE: This chart does not deploy PostgreSQL/Redis.
## Provide external database and redis connection info under api.config.* and credentials under secrets.*.

api:
  enabled: true
  replicaCount: 2
  image: pytoya/api
  tag: latest
  pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 3000
    nodePort: null
  resources:
    requests:
      cpu: "1"
      memory: "1Gi"
    limits:
      cpu: "2"
      memory: "2Gi"
  persistence:
    enabled: true
    size: 50Gi
    storageClass: ""
    accessModes:
      - ReadWriteOnce
  config:
    server:
      port: 3000
      logLevel: info
    database:
      host: ""
      port: 5432
      username: ""
      database: ""
    redis:
      host: ""
      port: 6379
    queue:
      extraction:
        concurrency: 5
    jwt:
      expiration: 7d
    paddleocr:
      baseUrl: ""
    security:
      cors:
        enabled: true
        allowedOrigins:
          - "http://localhost:3001"
        credentials: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - PATCH
        allowedHeaders:
          - Content-Type
          - Authorization
      rateLimit:
        enabled: true
        ttl: 60000
        limit: 120
        storage: memory
      accountLockout:
        enabled: true
        thresholds:
          - attempts: 5
            duration: 900000
          - attempts: 10
            duration: 3600000
          - attempts: 15
            permanent: true
      passwordPolicy:
        minLength: 8
        maxLength: 128
        requireUppercase: true
        requireLowercase: true
        requireNumber: true
        requireSpecialChar: true
        specialChars: "@$!%*?&"
      usernamePolicy:
        minLength: 3
        maxLength: 50
        pattern: "^[a-zA-Z][a-zA-Z0-9_-]*$"
    features:
      manualExtraction: true
  healthCheck:
    path: /api/health
    initialDelay: 30
    period: 10

worker:
  # Optional separate worker deployment for BullMQ processing.
  # When enabled, API pods disable in-process workers and only serve HTTP/WS.
  enabled: false
  replicaCount: 1
  image: pytoya/api
  tag: latest
  pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: "1"
      memory: "1Gi"
    limits:
      cpu: "2"
      memory: "2Gi"

web:
  enabled: true
  replicaCount: 2
  image: pytoya/web
  tag: latest
  pullPolicy: IfNotPresent
  containerPort: 3000
  service:
    type: ClusterIP
    port: 80
    nodePort: null
  resources:
    requests:
      cpu: "500m"
      memory: "512Mi"
    limits:
      cpu: "1"
      memory: "1Gi"
  healthCheck:
    path: /
    initialDelay: 30
    period: 10

ingress:
  enabled: true
  className: ""
  annotations:
    kubernetes.io/ingress.class: nginx
  tls: []
  hosts: []

hpa:
  api:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80
  web:
    enabled: false
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 80

secrets:
  # External DB password for the API (required when postgres.enabled=false)
  dbPassword: ""
  # JWT signing secret for the API (required)
  jwtSecret: ""

migrations:
  enabled: true
  backoffLimit: 1
  ttlSecondsAfterFinished: 300
